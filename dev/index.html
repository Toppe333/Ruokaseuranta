<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruokaseuranta</title>

<style>
body { font-family: Arial, sans-serif; max-width: 750px; margin: auto; padding: 1rem; }

.dev-banner {
  background:#fff3cd;
  border:1px solid #ffeeba;
  color:#856404;
  padding:0.75rem;
  margin-bottom:1rem;
  text-align:center;
  font-weight:bold;
}

.section { border: 1px solid #ccc; padding: 1rem; margin-top: 1rem; }
.meal-controls, .training-controls { display: flex; gap: 0.5rem; }
select, input, button { padding: 0.4rem; }
.meal-controls select { flex: 1; }
.item { display: flex; justify-content: space-between; margin-top: 0.3rem; }
.item button { width: auto; }
.locked { opacity: 0.6; pointer-events: none; }
.summary-boxes { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.summary-box { border: 1px solid #ccc; padding: 0.5rem; min-width: 90px; text-align: center; }
.summary-box.positive { background:#e6f4ea; color:#1e6b3a; }
.summary-box.negative { background:#fbeaea; color:#8a1f1f; }
.summary-box.zero { background:#eee; color:#333; }
.summary-box.nodata { background:#f5f5f5; color:#777; font-style:italic; }

.top-buttons { display:flex; justify-content:flex-end; gap:0.5rem; margin-bottom:1rem; }
#unlockBtn { margin-top:0.5rem; }
</style>
</head>
<body>

<div class="dev-banner">
⚠️ Kehitysversio – tätä versiota käytetään testaamiseen. Älä luota tuotantodataan.
</div>

<h2>Ruokaseuranta</h2>
<h4>versio DEV 1.2</h4>

<div class="top-buttons">
  <button onclick="downloadCSV()">CSV-varmuuskopio</button>
  <button onclick="backupJSON()">JSON-varmuuskopio</button>
  <button onclick="restoreJSON()">Palauta JSON</button>
</div>

<label>Päivä</label>
<input type="date" id="date">
<br>
<button id="unlockBtn" style="display:none;" onclick="unlockDay()">Muokkaa tietoja</button>

<div id="content">

<!-- AAMUPALA -->
<div class="section" id="aamupala">
<h3>Aamupala</h3>
<div class="meal-controls">
<select id="aamupalaSelect"></select>
<input type="number" id="aamupalaGrams" placeholder="g">
<button onclick="addFood('aamupala')">Lisää</button>
</div>
<div class="foods"></div>
</div>

<!-- LOUNAS -->
<div class="section" id="lounas">
<h3>Lounas</h3>
<div class="meal-controls">
<select id="lounasSelect"></select>
<input type="number" id="lounasGrams" placeholder="g">
<button onclick="addFood('lounas')">Lisää</button>
</div>
<div class="foods"></div>
</div>

<!-- VÄLIPALAT -->
<div class="section" id="valipalat">
<h3>Välipalat</h3>
<div class="meal-controls">
<select id="valipalatSelect"></select>
<input type="number" id="valipalatGrams" placeholder="g">
<button onclick="addFood('valipalat')">Lisää</button>
</div>
<div class="foods"></div>
</div>

<!-- ILLALLINEN -->
<div class="section" id="illallinen">
<h3>Illallinen</h3>
<div class="meal-controls">
<select id="illallinenSelect"></select>
<input type="number" id="illallinenGrams" placeholder="g">
<button onclick="addFood('illallinen')">Lisää</button>
</div>
<div class="foods"></div>
</div>

<!-- ILTAPALA -->
<div class="section" id="iltapala">
<h3>Iltapala</h3>
<div class="meal-controls">
<select id="iltapalaSelect"></select>
<input type="number" id="iltapalaGrams" placeholder="g">
<button onclick="addFood('iltapala')">Lisää</button>
</div>
<div class="foods"></div>
</div>

<!-- TREENIT -->
<div class="section">
<h3>Treenit</h3>
<div class="training-controls">
<input id="trainingName" placeholder="Treenin nimi">
<input id="trainingKcal" type="number" placeholder="kcal">
<button onclick="addTraining()">Lisää</button>
</div>
<div id="trainings"></div>
</div>

<button id="saveBtn" onclick="saveDay()">Tallenna päivä</button>

<div class="section">
<h3>Yhteenveto</h3>
<div id="summary"></div>
<div id="fiveDaySummary"></div>
</div>

</div>

<script>
/* --- KAIKKI AIEMPI JS SÄILYTETTY --- */
</script>

<script>
/* =========================
   JSON VARMUUSKOPIO
   ========================= */

function backupJSON() {
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    data[key] = localStorage.getItem(key);
  }
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "ruokaseuranta_backup.json";
  a.click();
}

function restoreJSON() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "application/json";
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      const data = JSON.parse(reader.result);
      localStorage.clear();
      Object.keys(data).forEach(k => localStorage.setItem(k, data[k]));
      alert("Varmuuskopio palautettu. Sivu ladataan uudelleen.");
      location.reload();
    };
    reader.readAsText(file);
  };
  input.click();
}
</script>

</body>
</html>
